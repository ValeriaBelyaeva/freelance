````markdown
# Joint Replacement System  
Документация к модулю `joint_replacement_system.py`
*Версия 1.0 · Последнее обновление: 27 мая 2025 г.*

---

## Содержание
1. [Назначение](#назначение)  
2. [Зависимости](#зависимости)  
3. [Запуск примера](#запуск-примера)  
4. [Архитектура и поток выполнения](#архитектура-и-поток-выполнения)  
5. [GUI-компоненты](#gui-компоненты)  
6. [API-справочник](#api-справочник)  
7. [Часто задаваемые вопросы](#часто-задаваемые-вопросы)  

---

## Назначение
Библиотека решает задачу переназначения **joint-ов** (скелетных узлов) при импорте/слиянии сцен в Autodesk Maya.  
Если исходные имена узлов отсутствуют в сцене, пользователю предлагается интерактивное окно для массового добавления или удаления префикса, либо ручного ввода новых имён. В итоговом словаре ключи заменяются на корректные, а веса (`paint_weights`) и метод скиннинга (`skinningMethod`) остаются без изменений.

---

## Зависимости
| Пакет   | Версия | Назначение                |
|---------|--------|---------------------------|
| Python  | ≥ 3.7  | интерпретатор             |
| PyQt5   | ≥ 5.15 | построение графического UI|

**Системные требования:**  
- Autodesk Maya с активным Python-интерпретатором (внутренний или standalone).  
- ОС Windows / Linux / macOS, совместимая с PyQt5.

---

## Запуск примера
```bash
python joint_replacement_system.py
````

В консоль будет выведен результирующий словарь. При отсутствии нераспознанных joint-ов окно не отображается.

---

## Архитектура и поток выполнения

```text
┌──────────────────────┐
│ joint_replacement_system(in_weights) │
└───────┬────────────────┘
        │ Проверка наличия joint-ов в сцене (is_obj_in_scene)
        │
   ┌────▼─────┐ joints присутствуют
   │ Возврат  │ исходного словаря
   └──────────┘
        │
        │ joints отсутствуют
┌───────▼────────┐
│ JointReplacementDialog │  ←— UI-диалог
└───────┬────────┘
        │ accept / reject
        ▼
Возврат откорректированного словаря
```

1. **Фильтрация**: из `in_weights` исключаются служебные ключи `paint_weights`, `skinningMethod`.
2. **Проверка**: для каждого joint вызывается `is_obj_in_scene`.
3. **Диалог**: если найден хотя бы один отсутствующий joint, открывается `JointReplacementDialog`.
4. **Обработка**: после нажатия *Apply* собирается новый словарь; непереназначенные joint-ы копируются без изменений.

---

## GUI-компоненты

| Виджет                     | Класс     | Назначение                                                                                                                                                                          |
| -------------------------- | --------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **JointWidget**            | `QWidget` | Строка в списке: имя → `QLineEdit` → кнопка «Add selected» (зарезервирована под логику выбора объекта из Maya Outliner).                                                            |
| **JointReplacementDialog** | `QDialog` | Содержит: <br>• блок «Namespace» (поля + кнопки *Add* / *Subtract*) для пакетной модификации префикса;<br>• `QScrollArea` со списком `JointWidget`;<br>• кнопки *Apply* / *Cancel*. |

> **Важно:** методы `edit_namespace_add` / `edit_namespace_sub` выполняют однотипные операции над всеми строками списка.

---

## API-справочник

### `JointWidget(name: str, parent: Optional[QWidget] = None)`

| Атрибут     | Тип           | Описание                                   |
| ----------- | ------------- | ------------------------------------------ |
| `label`     | `QLabel`      | Отображаемое имя joint-а.                  |
| `line_edit` | `QLineEdit`   | Поле для ввода/редактирования имени.       |
| `button`    | `QPushButton` | Зарезервирована под выбор объекта в сцене. |

| Метод            | Описание                                    |
| ---------------- | ------------------------------------------- |
| `delete_self()`  | Асинхронно удаляет виджет (`deleteLater`).  |
| `add_selected()` | *Заглушка*: печать текущего текста `label`. |

---

### `JointReplacementDialog(data: dict, parent: Optional[QWidget] = None)`

| Атрибут     | Тип                      | Описание                                   |
| ----------- | ------------------------ | ------------------------------------------ |
| `data`      | `dict[str, list[float]]` | Словарь отсутствующих joint-ов и их весов. |
| `item_list` | `list[JointWidget]`      | Ссылки на созданные строки списка.         |

| Метод                  | Описание                                                |
| ---------------------- | ------------------------------------------------------- |
| `edit_namespace_add()` | Добавляет префикс `namespace:` ко всем строкам.         |
| `edit_namespace_sub()` | Удаляет заданный префикс, если совпадает целиком.       |
| `add_items()`          | Заполняет `scroll_area` элементами на основании `data`. |
| `get_data() -> dict`   | Формирует и возвращает откорректированный словарь.      |

---

### `is_obj_in_scene(obj: str) -> bool`

Заглушка для проверки наличия объекта в сцене. При интеграции с Maya замените вызовом `cmds.objExists(obj)`.

### `joint_replacement_system(in_weights: dict) -> dict`

Главная функция модуля. Принимает исходный словарь, возвращает либо его же, либо откорректированный после работы диалога.

---

## Часто задаваемые вопросы

### Что делать, если кнопка **Add selected** ничего не делает?

Метод `add_selected` пока выводит текст в консоль. Подключите к нему собственную логику, например поиск выделенного объекта в Maya и вставку его имени в `line_edit`.

### Как изменить условие проверки наличия объекта?

Замените тело `is_obj_in_scene` вызовом Maya-команды `cmds.objExists` или любым другим методом.

### Как отключить обработку служебных ключей?

Отредактируйте константный список внутри `joint_replacement_system`, содержащий `'paint_weights'`, `'skinningMethod'`.

---
