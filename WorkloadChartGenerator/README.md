# Workload Chart Generator

Генератор графиков рабочей нагрузки. Обрабатывает данные из JSON, сглаживает их и сохраняет график в виде PNG-файла.

---

## Возможности

| Функция                 | Описание                                                                                       |
|-------------------------|---------------------------------------------------------------------------------------------------|
| **Обработка данных**    | Агрегирует проценты по проектам и датам, фильтрует пустые дни.                                    |
| **Сглаживание**         | Применяет скользящее среднее (размер окна настраивается через параметры или методы класса).       |
| **Генерация графика**   | Строит график рабочей нагрузки по проектам во времени.                                           |
| **Сохранение**          | Сохраняет график в PNG-файл во временную директорию (по умолчанию).                              |
| **Логирование**         | Использует стандартный модуль logging для статуса и ошибок.                                      |
| **Настройки**           | Все пути и параметры по умолчанию вынесены в settings.py.                                        |

---

## Зависимости

- Python 3.7+
- pandas
- matplotlib

---

## Структура проекта

```
WorkloadChartGenerator/
├── charts/                   # (Не используется по умолчанию)
├── workloadChartGenerator.py # Основной модуль
├── reports.json              # Пример входных данных
├── requirements.txt          # Зависимости
├── settings.py               # Все строковые параметры и дефолтные значения
└── README.md                 # Этот файл
```

---

## Быстрый старт

1. **Перейдите в директорию проекта:**
    ```bash
    cd путь/к/WorkloadChartGenerator
    ```
2. **Создайте и активируйте виртуальное окружение:**
    ```bash
    python -m venv .venv
    .\.venv\Scripts\activate  # Windows
    # или source .venv/bin/activate  # Linux/macOS
    ```
3. **Установите зависимости:**
    ```bash
    pip install -r requirements.txt
    ```
4. **Настройте параметры (опционально):**
    - Все пути и параметры по умолчанию находятся в `settings.py`.
    - По умолчанию используется файл `reports.json` и сглаживание окна 3.
5. **Запустите основной скрипт:**
    ```bash
    python workloadChartGenerator.py
    ```
    По умолчанию будет обработан файл `reports.json`, график сохранится во временную директорию, путь к файлу появится в логе.

---

## Использование класса

### Инициализация

```python
from workloadChartGenerator import WorkloadGraph
import json

with open('reports.json', encoding='utf-8') as f:
    input_data = json.load(f)

graph = WorkloadGraph(input_data, smoothing=3)
```
- `input_data` (dict): Исходные данные (загрузите из JSON самостоятельно)
- `start_date` (datetime, опционально): Начальная дата (по умолчанию 8 января текущего года)
- `end_date` (datetime, опционально): Конечная дата (по умолчанию сегодня)
- `smoothing` (int, по умолчанию 3): Размер окна сглаживания (1 — без сглаживания)

### Основные методы

- **prepare_data()** — готовит данные для графика (агрегирует, преобразует, фильтрует, вызывает сглаживание)
- **get_smooth() / set_smooth(value)** — получить/установить размер окна сглаживания и автоматически обновить сглажённые данные
- **generate_graph()** — сохраняет график в PNG-файл во временную директорию, возвращает путь к файлу
- **show_graph()** — строит и показывает график (используется для проверки)

### Пример

```python
import json
from workloadChartGenerator import WorkloadGraph

with open('reports.json', encoding='utf-8') as f:
    input_data = json.load(f)

graph = WorkloadGraph(input_data, smoothing=5)
graph.prepare_data()
graph.set_smooth(7)  # изменить окно сглаживания
chart_path = graph.generate_graph()
print(f'График сохранён: {chart_path}')

graph.show_graph()  # показать график
```

---

## Примечания

- Даты в `reports.json` должны быть в формате "ММ-ДД" (например, "01-15").
- Скрипт связывает даты с текущим годом (или используйте start_date/end_date).
- График сохраняется во временную директорию ОС (например, `/tmp` или `C:\Users\...\AppData\Local\Temp`).
- Для логирования используется стандартный модуль logging.
- Все строковые параметры и дефолтные значения — в `settings.py`.

---

*Автор: Валерия Беляева, 2025 г.*
